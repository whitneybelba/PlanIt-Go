{% extends 'base.html' %}
{% block content %}
<title>Results</title>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<h4>Please review the tables below. You can link to the Yelp reviews for each business. If 
you decide you would like to add it to your itinerary, press the add button. You can add as
many as you would like.</h4>
{% if restaurant_list %}
{% if restaurant_list[0] %}            
<div class="container-fluid">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Restaurant Name</th>
        <th>Rating</th>
        <th>Number of Reviews</th>
        <th>City</th>
        <th>Categories</th>
        <th>Add to Trip?</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <!-- data is in the form of dictionaries in a list in a list -->
        {% for category in restaurant_list %}
        {% for restaurant in category %}
        <!-- restaurant is a ditionary with lists and dicts in it -->
        <td><a href="{{ restaurant['url'] }}" target="_blank">
        {{ restaurant['name'] }}</a></td>
        <td><img src="{{ restaurant['rating_img_url'] }}"></td>
        <td>{{ restaurant['review_count']}}</td>
        <td>{{ restaurant['location']['city'] }}</td>
        <td>{{ restaurant['category'] }}</td>
        <td><button type="button" id="{{ restaurant['id'] }}" data-trip_id={{ trip_id }} data-long={{ restaurant['location']['coordinate']['longitude'] }} data-lat={{ restaurant['location']['coordinate']['latitude'] }} data-name={{ restaurant['name'] }} data-location={{ restaurant['location']['city'] }} class="btn">Add</button></td>
      </tr>
        {% endfor %}
        {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endif %}

{% if bar_list %}
{% if bar_list[0] %}
<div class="container-fluid">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Bar Name</th>
        <th>Rating</th>
        <th>Number of Reviews</th>
        <th>City</th>
        <th>Categories</th>
        <th>Add to Trip?</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        {% for category in bar_list %}
        {% for bar in category %}
        <td><a href="{{ bar['url'] }}" target="_blank">
        {{ bar['name'] }}</a></td>
        <td><img src="{{ bar['rating_img_url'] }}"></td>
        <td>{{ bar['review_count']}}</td>
        <td>{{ bar['location']['city'] }}</td>
        <td>{{ bar['category'] }}</td>
        <td><button type="button" id="{{ bar['id'] }}" data-trip_id={{ trip_id }} data-long={{ bar['location']['coordinate']['longitude'] }} data-lat={{ bar['location']['coordinate']['latitude'] }} data-name={{ bar['name'] }} data-location={{ bar['location']['city'] }} class="btn">Add</button></td>
      </tr>
        {% endfor %}
        {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endif %}

{% if activity_list %}
{% if activity_list[0] %}
<div class="container-fluid">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Activity/Business Name</th>
        <th>Rating</th>
        <th>Number of Reviews</th>
        <th>City</th>
        <th>Categories</th>
        <th>Add to Trip?</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        {% for category in activity_list %}
        {% for activity in category %}
        <td><a href="{{ activity['url'] }}" target="_blank">
        {{ activity['name'] }}</a></td>
        <td><img src="{{ activity['rating_img_url'] }}"></td>
        <td>{{ activity['review_count']}}</td>
        <td>{{ activity['location']['city'] }}</td>
        <td>{{ activity['category'] }}</td>
        <td><button type="button" id="{{ activity['id'] }}" data-trip_id={{ trip_id }} data-long={{ activity['location']['coordinate']['longitude'] }} data-lat={{ activity['location']['coordinate']['latitude'] }} data-name={{ activity['name'] }} data-location={{ activity['location']['city'] }} class="btn">Add</button></td>
      </tr>
        {% endfor %}
        {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endif %}
<div class="yelpbutton">
<a href="http://www.yelp.com">
<img border="10" alt="Yelp" src="../static/img/yelp_powered_btn_dark.png">
</a></div>

<script type="text/javascript">

function addedRestaurant(result) {
  console.log(result);
}

function sendRestaurantInfo(evt) {
  var payload = {
    "location": this.dataset.location,
    "name": this.dataset.name,
    "lat": this.dataset.lat,
    "long": this.dataset.long,
    "id": this.id,
    "trip_id": this.dataset.trip_id
  };
$.post('/add-restaurant', payload, addedRestaurant);
}

$('.btn').on('click', sendRestaurantInfo);

function addedBar(result) {
  console.log(result);
}

function sendBarInfo(evt) {
  var payload = {
    "location": this.dataset.location,
    "name": this.dataset.name,
    "lat": this.dataset.lat,
    "long": this.dataset.long,
    "id": this.id,
    "trip_id": this.dataset.trip_id
  };
$.post('/add-bar', payload, addedBar);
}

$('.btn').on('click', sendBarInfo);


function addedActivity(result) {
  console.log(result);
}

function sendActivityInfo(evt) {
  var payload = {
    "location": this.dataset.location,
    "name": this.dataset.name,
    "lat": this.dataset.lat,
    "long": this.dataset.long,
    "id": this.id,
    "trip_id": this.dataset.trip_id
  };
$.post('/add-activity', payload, addedActivity);
}

$('.btn').on('click', sendActivityInfo);

</script>
  
{% endblock %}
